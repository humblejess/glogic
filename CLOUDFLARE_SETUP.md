# Cloudflare Dashboard é…ç½®æŒ‡å—

## ğŸ“ API ç«¯ç‚¹è®¾ç½®ä½ç½®

**é‡è¦ï¼š** API ç«¯ç‚¹**ä¸éœ€è¦**åœ¨ Cloudflare Dashboard ä¸Šæ‰‹åŠ¨åˆ›å»ºï¼

Cloudflare Pages Functions ä¼šæ ¹æ®é¡¹ç›®ä¸­çš„ `functions` ç›®å½•ç»“æ„**è‡ªåŠ¨åˆ›å»º** API è·¯ç”±ã€‚

## ğŸ”§ éœ€è¦åœ¨ Dashboard ä¸Šé…ç½®çš„å†…å®¹

### 1. ç»‘å®š D1 æ•°æ®åº“åˆ° Pages Functions

è¿™æ˜¯**å”¯ä¸€éœ€è¦åœ¨ Dashboard ä¸Šé…ç½®**çš„å†…å®¹ï¼š

#### æ­¥éª¤ï¼š

1. **ç™»å½• Cloudflare Dashboard**
   - è®¿é—® https://dash.cloudflare.com

2. **è¿›å…¥ Pages é¡¹ç›®è®¾ç½®**
   - å·¦ä¾§èœå•ï¼š**Workers & Pages** â†’ **Pages**
   - ç‚¹å‡»ä½ çš„é¡¹ç›®åç§°ï¼ˆå¦‚ `glogic`ï¼‰

3. **è¿›å…¥ Functions è®¾ç½®**
   - ç‚¹å‡»é¡¶éƒ¨èœå•ï¼š**Settings**
   - å·¦ä¾§èœå•ï¼š**Functions**

4. **æ·»åŠ  D1 æ•°æ®åº“ç»‘å®š**
   - æ‰¾åˆ° **D1 Database bindings** éƒ¨åˆ†
   - ç‚¹å‡» **Add binding** æŒ‰é’®
   - å¡«å†™ï¼š
     - **Variable name**: `DB` âš ï¸ **å¿…é¡»å¡«å†™ `DB`**ï¼ˆä¸ä»£ç ä¸­çš„ `platform.env.DB` å¯¹åº”ï¼‰
     - **D1 database**: é€‰æ‹©ä½ åˆ›å»ºçš„æ•°æ®åº“ï¼ˆå¦‚ `glogic-db`ï¼‰
   - ç‚¹å‡» **Save**

5. **å®Œæˆ**
   - ç»‘å®šåï¼Œä½ çš„ Functions å°±å¯ä»¥é€šè¿‡ `platform.env.DB` è®¿é—®æ•°æ®åº“äº†

### 2. éªŒè¯ API ç«¯ç‚¹ï¼ˆéƒ¨ç½²åï¼‰

éƒ¨ç½²ä»£ç åï¼ŒAPI ç«¯ç‚¹ä¼šè‡ªåŠ¨å¯ç”¨ï¼š

- `POST /api/ranking` - æäº¤æ’åº
- `POST /api/view` - è®°å½•è®¿é—®
- `GET /api/stats` - è·å–ç»Ÿè®¡

**æµ‹è¯•æ–¹æ³•ï¼š**
```bash
# æµ‹è¯• stats API
curl https://your-domain.pages.dev/api/stats
```

## ğŸ“ æ–‡ä»¶ç»“æ„è¯´æ˜

```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ functions/              # Cloudflare Pages Functions ç›®å½•
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ ranking.ts      # è‡ªåŠ¨åˆ›å»º /api/ranking ç«¯ç‚¹
â”‚       â”œâ”€â”€ view.ts         # è‡ªåŠ¨åˆ›å»º /api/view ç«¯ç‚¹
â”‚       â””â”€â”€ stats.ts        # è‡ªåŠ¨åˆ›å»º /api/stats ç«¯ç‚¹
â””â”€â”€ src/                    # Astro é¡µé¢å’Œç»„ä»¶
```

## âš ï¸ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆæˆ‘åœ¨ Dashboard ä¸Šçœ‹ä¸åˆ° API ç«¯ç‚¹åˆ—è¡¨ï¼Ÿ
**A:** è¿™æ˜¯æ­£å¸¸çš„ï¼Cloudflare Pages Functions ä¸ä¼šåœ¨ Dashboard ä¸Šæ˜¾ç¤ºç«¯ç‚¹åˆ—è¡¨ï¼Œå®ƒä»¬æ˜¯æ ¹æ®ä»£ç è‡ªåŠ¨ç”Ÿæˆçš„ã€‚

### Q: å¦‚ä½•çŸ¥é“ API ç«¯ç‚¹æ˜¯å¦å·¥ä½œï¼Ÿ
**A:** 
1. éƒ¨ç½²ä»£ç åï¼Œè®¿é—® `https://your-domain.pages.dev/api/stats`
2. å¦‚æœè¿”å› JSON æ•°æ®ï¼Œè¯´æ˜ç«¯ç‚¹æ­£å¸¸å·¥ä½œ
3. å¦‚æœè¿”å› 404ï¼Œæ£€æŸ¥ `functions` ç›®å½•ç»“æ„æ˜¯å¦æ­£ç¡®

### Q: ç»‘å®šæ•°æ®åº“åè¿˜æ˜¯æŠ¥é”™ "Database not available"ï¼Ÿ
**A:** 
1. ç¡®è®¤ Variable name æ˜¯ `DB`ï¼ˆå¤§å†™ï¼‰
2. ç¡®è®¤æ•°æ®åº“åç§°é€‰æ‹©æ­£ç¡®
3. é‡æ–°éƒ¨ç½²é¡¹ç›®ï¼ˆç»‘å®šåéœ€è¦é‡æ–°éƒ¨ç½²æ‰èƒ½ç”Ÿæ•ˆï¼‰

## ğŸš€ å®Œæ•´é…ç½®æµç¨‹

1. âœ… åœ¨ Dashboard åˆ›å»º D1 æ•°æ®åº“
2. âœ… åœ¨ Dashboard ç»‘å®šæ•°æ®åº“åˆ° Pages Functionsï¼ˆVariable name: `DB`ï¼‰
3. âœ… åœ¨ä»£ç ä¸­åˆ›å»º `functions/api/` ç›®å½•å’Œæ–‡ä»¶
4. âœ… æ¨é€ä»£ç åˆ° GitHub
5. âœ… Cloudflare Pages è‡ªåŠ¨éƒ¨ç½²
6. âœ… API ç«¯ç‚¹è‡ªåŠ¨å¯ç”¨

## ğŸ“ æ£€æŸ¥æ¸…å•

- [ ] D1 æ•°æ®åº“å·²åˆ›å»º
- [ ] æ•°æ®åº“è¡¨å·²åˆ›å»ºï¼ˆuser_rankings, page_viewsï¼‰
- [ ] Pages Functions ä¸­å·²ç»‘å®š D1 æ•°æ®åº“ï¼ˆVariable name: `DB`ï¼‰
- [ ] `functions/api/` ç›®å½•å’Œæ–‡ä»¶å·²åˆ›å»º
- [ ] ä»£ç å·²æ¨é€åˆ° GitHub
- [ ] Cloudflare Pages å·²è‡ªåŠ¨éƒ¨ç½²
- [ ] æµ‹è¯• API ç«¯ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œ

